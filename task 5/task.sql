CREATE TABLE JOB (
    JOB_CODE VARCHAR(3) PRIMARY KEY,
    JOB_DESCRIPTION VARCHAR(25),
    JOB_CHG_HOUR FLOAT,
    JOB_LAST_UPDATE DATE
);

INSERT INTO JOB (JOB_CODE, JOB_DESCRIPTION, JOB_CHG_HOUR, JOB_LAST_UPDATE)
VALUES
('500', 'Programmer', 35.75, '2013-Nov-20'),
('501', 'Systems Analyst', 96.75, '2013-Nov-20'),
('502', 'Database Designer', 125, '2014-Mar-24'),
('503', 'Electrical Engineer', 84.5, '2013-Nov-20'),
('504', 'Mechanical Engineer', 67.9, '2013-Nov-20'),
('505', 'Civil Engineer', 55.78, '2013-Nov-20'),
('506', 'Clerical Support', 26.87, '2014-Nov-20'),
('507', 'DSS Analyst', 45.95, '2013-Nov-20'),
('508', 'Applications Designer', 48.1, '2014-Mar-24'),
('509', 'Bio Technician', 34.55, '2013-Nov-20'),
('510', 'General Support', 18.36, '2013-Nov-20');

CREATE TABLE EMP_1 (
    EMP_NUM VARCHAR(3) PRIMARY KEY,
    EMP_LNAME VARCHAR(15),
    EMP_FNAME VARCHAR(15),
    EMP_INITIAL VARCHAR(1),
    EMP_HIREDATE DATE,
    JOB_CODE VARCHAR(3)
);

INSERT INTO EMP_1 (EMP_NUM, EMP_LNAME, EMP_FNAME, EMP_INITIAL, EMP_HIREDATE, JOB_CODE)
VALUES
('103', 'Arbough', 'June', 'E', '1996-Dec-01', '500'),
('104', 'Ramoras', 'Anne', 'K', '1987-Nov-15', '501'),
('105', 'Johnson', 'Alice', 'K', '1993-Feb-01', '502'),
('106', 'Smithfield', 'William', '', '2004-Jun-22', '500'),
('107', 'Alonzo', 'Maria', 'D', '1993-Oct-10', '500'),
('108', 'Washington', 'Ralph', 'B', '1991-Aug-22', '501'),
('109', 'Smith', 'Larry', 'W', '1997-Jul-18', '501');

INSERT INTO EMP_1 (EMP_NUM, EMP_LNAME, EMP_FNAME, EMP_INITIAL, EMP_HIREDATE, JOB_CODE)
VALUES
('101', 'News', 'John', 'G', '2000-Nov-08', '502'),             --2
('102', 'Senior', 'David', 'H', '1989-Jul-12', '501');        --2

CREATE TABLE PROJECT (
    PROJ_NUM VARCHAR(3) PRIMARY KEY,
    PROJ_NAME VARCHAR(25),
    PROJ_VALUE FLOAT,
    PROJ_BALANCE FLOAT,
    EMP_NUM VARCHAR(3),
    FOREIGN KEY (EMP_NUM) REFERENCES EMP_1(EMP_NUM)
);

INSERT INTO PROJECT (PROJ_NUM, PROJ_NAME, PROJ_VALUE, PROJ_BALANCE, EMP_NUM)
VALUES
('15', 'Evergreen', 1453500, 1002350, '103'),
('18', 'Amber Wave', 3500500, 2110346, '108'),
('22', 'Rolling Tide', 805000, 500345.2, '102'),
('25', 'Starflight', 2650500, 2309880, '107');

CREATE TABLE ASSIGNMENT (
    ASSIGN_NUM INT PRIMARY KEY,
    ASSIGN_DATE DATE,
    PROJ_NUM VARCHAR(3),
    EMP_NUM VARCHAR(3),
    ASSIGN_JOB VARCHAR(3),
    ASSIGN_CHG_HR FLOAT,
    ASSIGN_HOURS FLOAT,
    ASSIGN_CHARGE FLOAT,
    FOREIGN KEY (EMP_NUM) REFERENCES EMP_1(EMP_NUM),
    FOREIGN KEY (PROJ_NUM) REFERENCES PROJECT(PROJ_NUM)
);

INSERT INTO ASSIGNMENT (ASSIGN_NUM, ASSIGN_DATE, PROJ_NUM, EMP_NUM, ASSIGN_JOB, ASSIGN_CHG_HR, ASSIGN_HOURS, ASSIGN_CHARGE)
VALUES
('1001', '2014-Mar-22', '18', '103', '503', 84.5, 3.5, 295.75),
('1002', '2014-Mar-22', '22', '102', '509', 34.55, 4.2, 145.11),
('1003', '2014-Mar-22', '18', '107', '509', 34.55, 2, 69.10),
('1004', '2014-Mar-22', '18', '103', '503', 84.5, 5.9, 498.55),
('1005', '2014-Mar-22', '25', '108', '501', 96.75, 2.2, 212.85);





ALTER TABLE EMP_1       --1
ADD CONSTRAINT fk_jobcode FOREIGN KEY (JOB_CODE)
REFERENCES JOB(JOB_CODE);


SELECT * FROM EMP_1 WHERE JOB_CODE = 502;   --3


BEGIN TRANSACTION;       --4
COMMIT;          --4


BEGIN TRANSACTION;     --7

UPDATE EMP_1            --5
SET JOB_CODE = 501  
WHERE EMP_NUM = 107;

SELECT * FROM EMP_1 WHERE EMP_NUM = 107;   --5

UPDATE EMP_1          --5
SET JOB_CODE = 500  
WHERE EMP_NUM = 107;
SELECT * FROM EMP_1 WHERE EMP_NUM = 107;


DELETE FROM EMP_1         --6
WHERE EMP_LNAME = 'Smithfield' AND EMP_FNAME = 'William' AND EMP_HIREDATE = '2004-Jul-22'  AND JOB_CODE = 500;
 
ROLLBACK;        --7
SELECT * FROM EMP_1 WHERE EMP_LNAME = 'Smithfield'

SELECT * INTO EMP_2 FROM EMP_1;            --8
ALTER TABLE EMP_2 ADD EMP_PCT DECIMAL(4,2), PROJ_NUM CHAR(3);
SELECT * FROM EMP_2


UPDATE EMP_2         --9
SET EMP_PCT = 3.85  
WHERE EMP_NUM = '103';
SELECT * FROM EMP_2 WHERE EMP_NUM = '103';


UPDATE EMP_2       --10
SET PROJ_NUM = '18'
WHERE JOB_CODE = '500';
SELECT * FROM EMP_2 WHERE PROJ_NUM = '18';


UPDATE EMP_2        --11
SET PROJ_NUM = '25'
WHERE JOB_CODE >= 502;
SELECT * FROM EMP_2 WHERE PROJ_NUM = '25';


UPDATE EMP_2   --12
SET PROJ_NUM = '14'
WHERE EMP_HIREDATE < '1994-Jan-01' AND JOB_CODE >= 501;
SELECT * FROM EMP_2 WHERE PROJ_NUM = '14';


SELECT EMP_NUM, EMP_PCT    --13
INTO #TEMP_1 
FROM EMP_2;
SELECT * FROM #TEMP_1 


DROP TABLE #TEMP_1;   --14


SELECT * FROM EMP_1            --15
WHERE EMP_LNAME LIKE 'Smith%';


SELECT          --16
  PROJECT.PROJ_NAME, PROJECT.PROJ_VALUE, PROJECT.PROJ_BALANCE, 
  EMP_1.EMP_LNAME, EMP_1.EMP_FNAME, EMP_1.EMP_INITIAL, EMP_1.JOB_CODE, 
  JOB.JOB_DESCRIPTION, JOB.JOB_CHG_HOUR 
FROM EMP_1
JOIN JOB ON EMP_1.JOB_CODE = JOB.JOB_CODE
JOIN PROJECT ON EMP_1.EMP_NUM = PROJECT.EMP_NUM
WHERE JOB.JOB_CODE IN (500, 501);


--CREATE VIEW REP_1    --'CREATE VIEW' must be the first statement in a query batch.
SELECT           --17
  PROJECT.PROJ_NAME, PROJECT.PROJ_VALUE, PROJECT.PROJ_BALANCE, 
  EMP_1.EMP_LNAME, EMP_1.EMP_FNAME, EMP_1.EMP_INITIAL, EMP_1.JOB_CODE, 
  JOB.JOB_DESCRIPTION, JOB.JOB_CHG_HOUR
INTO REP_1
FROM EMP_1
JOIN JOB ON EMP_1.JOB_CODE = JOB.JOB_CODE
JOIN PROJECT ON EMP_1.EMP_NUM = PROJECT.EMP_NUM
WHERE JOB.JOB_CODE IN (500, 501);


SELECT AVG(EMP_PCT) AVG    --18
FROM EMP_2;


SELECT * FROM EMP_2     --19
ORDER BY EMP_PCT ASC;


SELECT DISTINCT PROJ_NUM FROM EMP_2;    --20


SELECT (ASSIGN_CHG_HR * ASSIGN_HOURS) ASSIGN_CHARGE     --21
FROM ASSIGNMENT;

SELECT EMP_NUM, SUM(ASSIGN_HOURS) HOURS, SUM(ASSIGN_CHARGE) CHARGE  --22
FROM ASSIGNMENT
GROUP BY EMP_NUM;


SELECT PROJ_NUM, SUM(ASSIGN_HOURS) HOURS, SUM(ASSIGN_CHG_HR * ASSIGN_HOURS) CHARGE --23
FROM ASSIGNMENT
GROUP BY PROJ_NUM;


SELECT HOURS, CHARGE        --24
FROM (
  SELECT 
    EMP_NUM, SUM(ASSIGN_HOURS) HOURS, SUM(ASSIGN_CHG_HR * ASSIGN_HOURS) CHARGE
  FROM ASSIGNMENT
  GROUP BY EMP_NUM
) SUM_EMP_NUM;


SELECT HOURS, CHARGE                 --25
FROM (
  SELECT 
    PROJ_NUM, SUM(ASSIGN_HOURS) HOURS, SUM(ASSIGN_CHG_HR * ASSIGN_HOURS) CHARGE
  FROM ASSIGNMENT
  GROUP BY PROJ_NUM
)Â SUM_PROJ_NUM;